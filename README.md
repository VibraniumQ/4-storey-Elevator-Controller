# 4-storey Elevator Controller

## 设计任务

设计一个4层楼房全自动电梯控制电路，功能如下：  
(1)	每层楼电梯入口处设有上、下请求开关各1。电梯内设有乘客到达层次的停站要求开关。  
(2)	有电梯所处位置指示装置和电梯上行、下行状态指示装置。  
(3)	每秒升（降）一层楼。到达某一层楼时，指示该层次的灯发光，并一直保持到电梯到达新一层为止。  
(4)	电梯到达有停站请求的楼层后，该层次的指示灯亮，经过0.5s，电梯门自动打开，开门指示灯亮；开门5s后，电梯门自动关闭（开门指示灯灭），电梯继续运行。  
(5)	能记忆电梯内、外的所有请求信号，并按照电梯运行规则依次响应，每个请求信号保留至执行后撤除。  
(6)	电梯运行规则：电梯处于上升模式时，只响应比电梯所在位段高的层次的上楼请求信号，由上而下逐个执行，直到最后一个请求执行。如最高楼层有下楼请求，则直接升到有下楼请求的最高楼层接客，然后便进入下降模式。电梯处于下降模式时，仅响应比电梯所在楼层低的楼层的下楼请求，由上到下逐一解决，直到最后一个请求被处理完毕。如最低楼层有上升请求，则降至该楼层，并转入上升模式。电梯执行完所有的请求后，应停在最后所在位置不变，等待新的请求。  
(7)	开机（接通电源）时，电梯应停在一楼，各种上、下请求应被消除。  

## 设计器材
### 软件
Quartus Prime 17.0  
Visual Studio Code 1.24  
Git 2.17.0  
### 硬件
MFB-5型数字电路自主实验器：Altera Cyclone EP4CE6E22C8

## 设计原理

### 设计思路

电梯控制器由四部分组成——计数器、请求处理、状态控制、显示接口。  
计数器部分包括：分频器、楼层转换计时器、开门计时器、延迟关门按钮。分频器用于将系统时钟频率降为4Hz，供给其他计时器模块使用。楼层转换计时器模块接收楼层变更信号，在电梯移动（上移或下移）结束后输出移动结束脉冲信号，告知状态控制模块电梯已经到达下一楼层。开门计时器模块在接收到开门信号后开始计时，随时间推移变更门指示灯显示，并在关门后发出信号告知状态控制模块电梯开门过程已结束，同时开门计时器也负责处理延迟关门与提前关门信号并作出相应的动作。延迟关门按钮模块是由于延迟关门动作较复杂而衍生的模块，接收延迟关门按钮信号，实现在人手松开按钮后5秒之后再进行关门的功能。  
显示接口部分包括：开门指示灯、电梯所在楼层指示灯。开门指示灯模块接收开门计时器给出的电梯门开关状态信号，给出相应的LED灯显示信号。电梯所在楼层指示灯接收状态控制模块给出的电梯所在楼层位置信号，输出相应的七段数码管显示。  
请求处理部分包括：电梯外请求接口、请求处理模块。电梯外请求接口接收电梯外按键信号，上、下行共6个1位信号转化为两组4位信号传递给请求处理模块。请求处理模块根据电梯电梯所在位置，给出当前模式下有效请求并判断当前运行模式，传递给状态控制模块。  
状态控制部分仅由状态控制模块构成。状态控制模块一方面接受有效请求与运行模式信号，对电梯的运行状态进行控制，另一方面在控制电梯状态转移的过程中给出开门指令与移动指令，并接收移动完毕信号与开门完毕信号，作出下一步操作。  

If there is any change, the final revision will prevail.  
`如果有什么意见或建议，可以在Issue中提出，也可以发送邮件告诉我`  
vibranium@foxmail.com  

2018/6/29
